def J_multiverse(state, lambda_levels=None, index_dim_fn=None):
    """
    Compute the multiverse functional J_multiverse(Ψ) over a MultiverseState.

    state: MultiverseState (dict-like, keys = multi-indices, values = vectors)
    lambda_levels: optional dict[level -> weight Λ_l]
    index_dim_fn: optional function to get level from index
    """
    # твой текущий код вычисления J_multiverse
    ...
